-- MySQL Script generated by MySQL Workbench
-- Mon Feb  9 10:25:37 2026
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema contralog
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema contralog
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `contralog` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `contralog` ;

-- -----------------------------------------------------
-- Table `contralog`.`usuarios`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`usuarios` (
  `id_usuario` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(100) NOT NULL,
  `email` VARCHAR(150) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `rol` ENUM('admin', 'colaborador') NOT NULL,
  `estado` ENUM('activo', 'inactivo') NULL DEFAULT 'activo',
  `ultimo_ingreso` TIMESTAMP NULL DEFAULT NULL,
  `created_at` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_usuario`),
  UNIQUE INDEX `email` (`email` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 10
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `contralog`.`auditoria_cambios`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`auditoria_cambios` (
  `id_log` INT NOT NULL AUTO_INCREMENT,
  `id_usuario` INT NULL DEFAULT NULL,
  `accion` VARCHAR(20) NULL DEFAULT NULL,
  `tabla_afectada` VARCHAR(50) NULL DEFAULT NULL,
  `id_registro_afectado` INT NULL DEFAULT NULL,
  `detalle_cambio` JSON NULL DEFAULT NULL,
  `fecha_cambio` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_log`),
  INDEX `id_usuario` (`id_usuario` ASC) VISIBLE,
  CONSTRAINT `auditoria_cambios_ibfk_1`
    FOREIGN KEY (`id_usuario`)
    REFERENCES `contralog`.`usuarios` (`id_usuario`))
ENGINE = InnoDB
AUTO_INCREMENT = 30
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `contralog`.`clientes`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`clientes` (
  `id_cliente` INT NOT NULL AUTO_INCREMENT,
  `tipo_persona` ENUM('natural', 'juridica') NOT NULL,
  `tipo_identificacion` ENUM('cc', 'ce', 'pasaporte', 'nit', 'pep') NOT NULL,
  `identificacion` VARCHAR(50) NOT NULL,
  `nombre_o_razon_social` VARCHAR(200) NOT NULL,
  `codigo_unico` VARCHAR(25) NOT NULL,
  `telefono` VARCHAR(20) NULL DEFAULT NULL,
  `email_contacto` VARCHAR(150) NULL DEFAULT NULL,
  `creado_por` INT NULL DEFAULT NULL,
  `activo` TINYINT(1) NULL DEFAULT '1' COMMENT 'Estado del cliente: 1 para activo, 0 para inactivo',
  `fecha_creacion` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Fecha y hora autom√°tica de registro',
  PRIMARY KEY (`id_cliente`),
  UNIQUE INDEX `identificacion` (`identificacion` ASC) VISIBLE,
  UNIQUE INDEX `codigo_unico` (`codigo_unico` ASC) VISIBLE,
  INDEX `creado_por` (`creado_por` ASC) VISIBLE,
  CONSTRAINT `clientes_ibfk_1`
    FOREIGN KEY (`creado_por`)
    REFERENCES `contralog`.`usuarios` (`id_usuario`))
ENGINE = InnoDB
AUTO_INCREMENT = 11
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `contralog`.`contratos_juridicos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`contratos_juridicos` (
  `id_contrato_j` INT NOT NULL AUTO_INCREMENT,
  `codigo_unico` VARCHAR(25) NOT NULL,
  `id_cliente` INT NOT NULL,
  `fecha_inicio` DATE NULL DEFAULT NULL,
  `fecha_final` DATE NULL DEFAULT NULL,
  `estado` ENUM('vencido', 'activo', 'por_vencer', 'cancelado', 'pendiente') NULL DEFAULT 'pendiente',
  `creado_por` INT NULL DEFAULT NULL,
  PRIMARY KEY (`id_contrato_j`),
  UNIQUE INDEX `codigo_unico` (`codigo_unico` ASC) VISIBLE,
  INDEX `id_cliente` (`id_cliente` ASC) VISIBLE,
  INDEX `fk_juridicos_creador` (`creado_por` ASC) VISIBLE,
  CONSTRAINT `contratos_juridicos_ibfk_1`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `contralog`.`clientes` (`id_cliente`),
  CONSTRAINT `fk_juridicos_creador`
    FOREIGN KEY (`creado_por`)
    REFERENCES `contralog`.`usuarios` (`id_usuario`))
ENGINE = InnoDB
AUTO_INCREMENT = 2
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `contralog`.`contratos_naturales`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`contratos_naturales` (
  `id_contrato_n` INT NOT NULL AUTO_INCREMENT,
  `codigo_unico` VARCHAR(25) NOT NULL,
  `id_cliente` INT NOT NULL,
  `fecha_inicio` DATE NULL DEFAULT NULL,
  `fecha_final` DATE NULL DEFAULT NULL,
  `s3_key_nda` VARCHAR(255) NULL DEFAULT NULL,
  `nda_firmado` TINYINT(1) NULL DEFAULT '0',
  `estado` ENUM('vencido', 'activo', 'por_vencer', 'cancelado', 'pendiente') NULL DEFAULT 'pendiente',
  `creado_por` INT NULL DEFAULT NULL,
  PRIMARY KEY (`id_contrato_n`),
  UNIQUE INDEX `codigo_unico` (`codigo_unico` ASC) VISIBLE,
  INDEX `id_cliente` (`id_cliente` ASC) VISIBLE,
  INDEX `fk_naturales_creador` (`creado_por` ASC) VISIBLE,
  CONSTRAINT `contratos_naturales_ibfk_1`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `contralog`.`clientes` (`id_cliente`),
  CONSTRAINT `fk_naturales_creador`
    FOREIGN KEY (`creado_por`)
    REFERENCES `contralog`.`usuarios` (`id_usuario`))
ENGINE = InnoDB
AUTO_INCREMENT = 7
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `contralog`.`tipo_documentos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`tipo_documentos` (
  `id_tipo` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id_tipo`))
ENGINE = InnoDB
AUTO_INCREMENT = 5
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `contralog`.`contrato_documentos`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`contrato_documentos` (
  `id_documento` INT NOT NULL AUTO_INCREMENT,
  `codigo_seguimiento` VARCHAR(25) NOT NULL,
  `id_contrato_j` INT NULL DEFAULT NULL,
  `id_contrato_n` INT NULL DEFAULT NULL,
  `id_tipo_doc` INT NOT NULL,
  `s3_key` VARCHAR(255) NOT NULL,
  `fecha_subida` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id_documento`),
  UNIQUE INDEX `codigo_seguimiento` (`codigo_seguimiento` ASC) VISIBLE,
  INDEX `fk_doc_juridico` (`id_contrato_j` ASC) VISIBLE,
  INDEX `fk_doc_natural` (`id_contrato_n` ASC) VISIBLE,
  INDEX `fk_tipo_doc` (`id_tipo_doc` ASC) VISIBLE,
  CONSTRAINT `fk_doc_juridico`
    FOREIGN KEY (`id_contrato_j`)
    REFERENCES `contralog`.`contratos_juridicos` (`id_contrato_j`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_doc_natural`
    FOREIGN KEY (`id_contrato_n`)
    REFERENCES `contralog`.`contratos_naturales` (`id_contrato_n`)
    ON DELETE CASCADE,
  CONSTRAINT `fk_tipo_doc`
    FOREIGN KEY (`id_tipo_doc`)
    REFERENCES `contralog`.`tipo_documentos` (`id_tipo`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `contralog`.`sesiones`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `contralog`.`sesiones` (
  `id_sesion` INT NOT NULL AUTO_INCREMENT,
  `id_usuario` INT NOT NULL,
  `fecha_ingreso` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `fecha_salida` TIMESTAMP NULL DEFAULT NULL,
  `duracion_minutos` INT NULL DEFAULT NULL,
  PRIMARY KEY (`id_sesion`),
  INDEX `id_usuario` (`id_usuario` ASC) VISIBLE,
  CONSTRAINT `sesiones_ibfk_1`
    FOREIGN KEY (`id_usuario`)
    REFERENCES `contralog`.`usuarios` (`id_usuario`))
ENGINE = InnoDB
AUTO_INCREMENT = 38
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
